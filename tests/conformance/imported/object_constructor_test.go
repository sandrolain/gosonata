// Code generated by importer. DO NOT EDIT.
// Source: thirdy/jsonata/test/test-suite/groups/object-constructor

package imported_test

import (
	"context"
	"testing"

	"github.com/sandrolain/gosonata/pkg/evaluator"
	"github.com/sandrolain/gosonata/pkg/parser"
)

// TestObjectConstructor runs 27 test cases from the official JSONata test suite.
// Group: object-constructor
func TestObjectConstructor(t *testing.T) {
	testCases := []struct {
		name        string
		query       string
		data        interface{}
		bindings    map[string]interface{}
		expected    interface{}
		shouldError bool
		errorCode   string
	}{

		{
			name:  "case000",
			query: `{}`,
			data:  map[string]interface{}{`bar`: 98, `foo`: map[string]interface{}{`bar`: 42, `blah`: []interface{}{map[string]interface{}{`baz`: map[string]interface{}{`fud`: `hello`}}, map[string]interface{}{`baz`: map[string]interface{}{`fud`: `world`}}, map[string]interface{}{`bazz`: `gotcha`}}, `blah.baz`: `here`}},

			expected: map[string]interface{}{},
		},

		{
			name:  "case001",
			query: `{"key": "value"}`,
			data:  map[string]interface{}{`bar`: 98, `foo`: map[string]interface{}{`bar`: 42, `blah`: []interface{}{map[string]interface{}{`baz`: map[string]interface{}{`fud`: `hello`}}, map[string]interface{}{`baz`: map[string]interface{}{`fud`: `world`}}, map[string]interface{}{`bazz`: `gotcha`}}, `blah.baz`: `here`}},

			expected: map[string]interface{}{`key`: `value`},
		},

		{
			name:  "case002",
			query: `{"one": 1, "two": 2}`,
			data:  map[string]interface{}{`bar`: 98, `foo`: map[string]interface{}{`bar`: 42, `blah`: []interface{}{map[string]interface{}{`baz`: map[string]interface{}{`fud`: `hello`}}, map[string]interface{}{`baz`: map[string]interface{}{`fud`: `world`}}, map[string]interface{}{`bazz`: `gotcha`}}, `blah.baz`: `here`}},

			expected: map[string]interface{}{`one`: 1, `two`: 2},
		},

		{
			name:  "case003",
			query: `{"one": 1, "two": 2}.two`,
			data:  map[string]interface{}{`bar`: 98, `foo`: map[string]interface{}{`bar`: 42, `blah`: []interface{}{map[string]interface{}{`baz`: map[string]interface{}{`fud`: `hello`}}, map[string]interface{}{`baz`: map[string]interface{}{`fud`: `world`}}, map[string]interface{}{`bazz`: `gotcha`}}, `blah.baz`: `here`}},

			expected: 2,
		},

		{
			name:  "case004",
			query: `{"one": 1, "two": {"three": 3, "four": "4"}}`,
			data:  map[string]interface{}{`bar`: 98, `foo`: map[string]interface{}{`bar`: 42, `blah`: []interface{}{map[string]interface{}{`baz`: map[string]interface{}{`fud`: `hello`}}, map[string]interface{}{`baz`: map[string]interface{}{`fud`: `world`}}, map[string]interface{}{`bazz`: `gotcha`}}, `blah.baz`: `here`}},

			expected: map[string]interface{}{`one`: 1, `two`: map[string]interface{}{`four`: `4`, `three`: 3}},
		},

		{
			name:  "case005",
			query: `{"one": 1, "two": [3, "four"]}`,
			data:  map[string]interface{}{`bar`: 98, `foo`: map[string]interface{}{`bar`: 42, `blah`: []interface{}{map[string]interface{}{`baz`: map[string]interface{}{`fud`: `hello`}}, map[string]interface{}{`baz`: map[string]interface{}{`fud`: `world`}}, map[string]interface{}{`bazz`: `gotcha`}}, `blah.baz`: `here`}},

			expected: map[string]interface{}{`one`: 1, `two`: []interface{}{3, `four`}},
		},

		{
			name:  "case006",
			query: `{"test": ()}`,
			data:  nil,

			expected: map[string]interface{}{},
		},

		{
			name:  "case007",
			query: `blah.{}`,
			data:  map[string]interface{}{`bar`: 98, `foo`: map[string]interface{}{`bar`: 42, `blah`: []interface{}{map[string]interface{}{`baz`: map[string]interface{}{`fud`: `hello`}}, map[string]interface{}{`baz`: map[string]interface{}{`fud`: `world`}}, map[string]interface{}{`bazz`: `gotcha`}}, `blah.baz`: `here`}},

			expected: nil,
		},

		{
			name:  "case008",
			query: `Account.Order{OrderID: Product."Product Name"}`,
			data:  map[string]interface{}{`Account`: map[string]interface{}{`Account Name`: `Firefly`, `Order`: []interface{}{map[string]interface{}{`OrderID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 2, `SKU`: `0406654608`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Orange`, `Depth`: 210, `Height`: 200, `Weight`: 0.6, `Width`: 300}, `Price`: 21.67, `Product Name`: `Trilby hat`, `ProductID`: 858236, `Quantity`: 1, `SKU`: `0406634348`}}}, map[string]interface{}{`OrderID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 4, `SKU`: `040657863`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Black`, `Depth`: 210, `Height`: 20, `Weight`: 2, `Width`: 30}, `Price`: 107.99, `Product Name`: `Cloak`, `ProductID`: 345664, `Quantity`: 1, `SKU`: `0406654603`}}}}}},

			expected: map[string]interface{}{`order103`: []interface{}{`Bowler Hat`, `Trilby hat`}, `order104`: []interface{}{`Bowler Hat`, `Cloak`}},
		},

		{
			name:  "case009",
			query: `Account.Order.{OrderID: Product."Product Name"}`,
			data:  map[string]interface{}{`Account`: map[string]interface{}{`Account Name`: `Firefly`, `Order`: []interface{}{map[string]interface{}{`OrderID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 2, `SKU`: `0406654608`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Orange`, `Depth`: 210, `Height`: 200, `Weight`: 0.6, `Width`: 300}, `Price`: 21.67, `Product Name`: `Trilby hat`, `ProductID`: 858236, `Quantity`: 1, `SKU`: `0406634348`}}}, map[string]interface{}{`OrderID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 4, `SKU`: `040657863`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Black`, `Depth`: 210, `Height`: 20, `Weight`: 2, `Width`: 30}, `Price`: 107.99, `Product Name`: `Cloak`, `ProductID`: 345664, `Quantity`: 1, `SKU`: `0406654603`}}}}}},

			expected: []interface{}{map[string]interface{}{`order103`: []interface{}{`Bowler Hat`, `Trilby hat`}}, map[string]interface{}{`order104`: []interface{}{`Bowler Hat`, `Cloak`}}},
		},

		{
			name:  "case010",
			query: `Account.Order.Product{$string(ProductID): Price}`,
			data:  map[string]interface{}{`Account`: map[string]interface{}{`Account Name`: `Firefly`, `Order`: []interface{}{map[string]interface{}{`OrderID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 2, `SKU`: `0406654608`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Orange`, `Depth`: 210, `Height`: 200, `Weight`: 0.6, `Width`: 300}, `Price`: 21.67, `Product Name`: `Trilby hat`, `ProductID`: 858236, `Quantity`: 1, `SKU`: `0406634348`}}}, map[string]interface{}{`OrderID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 4, `SKU`: `040657863`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Black`, `Depth`: 210, `Height`: 20, `Weight`: 2, `Width`: 30}, `Price`: 107.99, `Product Name`: `Cloak`, `ProductID`: 345664, `Quantity`: 1, `SKU`: `0406654603`}}}}}},

			expected: map[string]interface{}{`345664`: 107.99, `858236`: 21.67, `858383`: []interface{}{34.45, 34.45}},
		},

		{
			name:  "case011",
			query: `Account.Order.Product{$string(ProductID): (Price)[0]}`,
			data:  map[string]interface{}{`Account`: map[string]interface{}{`Account Name`: `Firefly`, `Order`: []interface{}{map[string]interface{}{`OrderID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 2, `SKU`: `0406654608`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Orange`, `Depth`: 210, `Height`: 200, `Weight`: 0.6, `Width`: 300}, `Price`: 21.67, `Product Name`: `Trilby hat`, `ProductID`: 858236, `Quantity`: 1, `SKU`: `0406634348`}}}, map[string]interface{}{`OrderID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 4, `SKU`: `040657863`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Black`, `Depth`: 210, `Height`: 20, `Weight`: 2, `Width`: 30}, `Price`: 107.99, `Product Name`: `Cloak`, `ProductID`: 345664, `Quantity`: 1, `SKU`: `0406654603`}}}}}},

			expected: map[string]interface{}{`345664`: 107.99, `858236`: 21.67, `858383`: 34.45},
		},

		{
			name:  "case012",
			query: `Account.Order.Product.{$string(ProductID): Price}`,
			data:  map[string]interface{}{`Account`: map[string]interface{}{`Account Name`: `Firefly`, `Order`: []interface{}{map[string]interface{}{`OrderID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 2, `SKU`: `0406654608`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Orange`, `Depth`: 210, `Height`: 200, `Weight`: 0.6, `Width`: 300}, `Price`: 21.67, `Product Name`: `Trilby hat`, `ProductID`: 858236, `Quantity`: 1, `SKU`: `0406634348`}}}, map[string]interface{}{`OrderID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 4, `SKU`: `040657863`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Black`, `Depth`: 210, `Height`: 20, `Weight`: 2, `Width`: 30}, `Price`: 107.99, `Product Name`: `Cloak`, `ProductID`: 345664, `Quantity`: 1, `SKU`: `0406654603`}}}}}},

			expected: []interface{}{map[string]interface{}{`858383`: 34.45}, map[string]interface{}{`858236`: 21.67}, map[string]interface{}{`858383`: 34.45}, map[string]interface{}{`345664`: 107.99}},
		},

		{
			name:  "case013",
			query: `Account.Order.Product{ProductID: "Product Name"}`,
			data:  map[string]interface{}{`Account`: map[string]interface{}{`Account Name`: `Firefly`, `Order`: []interface{}{map[string]interface{}{`OrderID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 2, `SKU`: `0406654608`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Orange`, `Depth`: 210, `Height`: 200, `Weight`: 0.6, `Width`: 300}, `Price`: 21.67, `Product Name`: `Trilby hat`, `ProductID`: 858236, `Quantity`: 1, `SKU`: `0406634348`}}}, map[string]interface{}{`OrderID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 4, `SKU`: `040657863`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Black`, `Depth`: 210, `Height`: 20, `Weight`: 2, `Width`: 30}, `Price`: 107.99, `Product Name`: `Cloak`, `ProductID`: 345664, `Quantity`: 1, `SKU`: `0406654603`}}}}}},

			shouldError: true,
			errorCode:   "T1003",
		},

		{
			name:  "case014",
			query: `Account.Order.Product.{ProductID: "Product Name"}`,
			data:  map[string]interface{}{`Account`: map[string]interface{}{`Account Name`: `Firefly`, `Order`: []interface{}{map[string]interface{}{`OrderID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 2, `SKU`: `0406654608`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Orange`, `Depth`: 210, `Height`: 200, `Weight`: 0.6, `Width`: 300}, `Price`: 21.67, `Product Name`: `Trilby hat`, `ProductID`: 858236, `Quantity`: 1, `SKU`: `0406634348`}}}, map[string]interface{}{`OrderID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 4, `SKU`: `040657863`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Black`, `Depth`: 210, `Height`: 20, `Weight`: 2, `Width`: 30}, `Price`: 107.99, `Product Name`: `Cloak`, `ProductID`: 345664, `Quantity`: 1, `SKU`: `0406654603`}}}}}},

			shouldError: true,
			errorCode:   "T1003",
		},

		{
			name:  "case015",
			query: `Account.Order{OrderID: $sum(Product.(Price*Quantity))}`,
			data:  map[string]interface{}{`Account`: map[string]interface{}{`Account Name`: `Firefly`, `Order`: []interface{}{map[string]interface{}{`OrderID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 2, `SKU`: `0406654608`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Orange`, `Depth`: 210, `Height`: 200, `Weight`: 0.6, `Width`: 300}, `Price`: 21.67, `Product Name`: `Trilby hat`, `ProductID`: 858236, `Quantity`: 1, `SKU`: `0406634348`}}}, map[string]interface{}{`OrderID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 4, `SKU`: `040657863`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Black`, `Depth`: 210, `Height`: 20, `Weight`: 2, `Width`: 30}, `Price`: 107.99, `Product Name`: `Cloak`, `ProductID`: 345664, `Quantity`: 1, `SKU`: `0406654603`}}}}}},

			expected: map[string]interface{}{`order103`: 90.57000000000001, `order104`: 245.79000000000002},
		},

		{
			name:  "case016",
			query: `Account.Order.{OrderID: $sum(Product.(Price*Quantity))}`,
			data:  map[string]interface{}{`Account`: map[string]interface{}{`Account Name`: `Firefly`, `Order`: []interface{}{map[string]interface{}{`OrderID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 2, `SKU`: `0406654608`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Orange`, `Depth`: 210, `Height`: 200, `Weight`: 0.6, `Width`: 300}, `Price`: 21.67, `Product Name`: `Trilby hat`, `ProductID`: 858236, `Quantity`: 1, `SKU`: `0406634348`}}}, map[string]interface{}{`OrderID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 4, `SKU`: `040657863`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Black`, `Depth`: 210, `Height`: 20, `Weight`: 2, `Width`: 30}, `Price`: 107.99, `Product Name`: `Cloak`, `ProductID`: 345664, `Quantity`: 1, `SKU`: `0406654603`}}}}}},

			expected: []interface{}{map[string]interface{}{`order103`: 90.57000000000001}, map[string]interface{}{`order104`: 245.79000000000002}},
		},

		{
			name:  "case017",
			query: `Account.Order.Product{$."Product Name": Price, $."Product Name": Price}`,
			data:  map[string]interface{}{`Account`: map[string]interface{}{`Account Name`: `Firefly`, `Order`: []interface{}{map[string]interface{}{`OrderID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 2, `SKU`: `0406654608`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Orange`, `Depth`: 210, `Height`: 200, `Weight`: 0.6, `Width`: 300}, `Price`: 21.67, `Product Name`: `Trilby hat`, `ProductID`: 858236, `Quantity`: 1, `SKU`: `0406634348`}}}, map[string]interface{}{`OrderID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 4, `SKU`: `040657863`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Black`, `Depth`: 210, `Height`: 20, `Weight`: 2, `Width`: 30}, `Price`: 107.99, `Product Name`: `Cloak`, `ProductID`: 345664, `Quantity`: 1, `SKU`: `0406654603`}}}}}},

			shouldError: true,
			errorCode:   "D1009",
		},

		{
			name:  "case018",
			query: `Account.Order.Product{` + "`" + `Product Name` + "`" + `: Price, SKU: Price}`,
			data:  map[string]interface{}{`Account`: map[string]interface{}{`Account Name`: `Firefly`, `Order`: []interface{}{map[string]interface{}{`OrderID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 2, `SKU`: `0406654608`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Orange`, `Depth`: 210, `Height`: 200, `Weight`: 0.6, `Width`: 300}, `Price`: 21.67, `Product Name`: `Trilby hat`, `ProductID`: 858236, `Quantity`: 1, `SKU`: `0406634348`}}}, map[string]interface{}{`OrderID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 4, `SKU`: `040657863`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Black`, `Depth`: 210, `Height`: 20, `Weight`: 2, `Width`: 30}, `Price`: 107.99, `Product Name`: `Cloak`, `ProductID`: 345664, `Quantity`: 1, `SKU`: `0406654603`}}}}}},

			expected: map[string]interface{}{`040657863`: 34.45, `0406634348`: 21.67, `0406654603`: 107.99, `0406654608`: 34.45, `Bowler Hat`: []interface{}{34.45, 34.45}, `Cloak`: 107.99, `Trilby hat`: 21.67},
		},

		{
			name:  "case019",
			query: `Account.Order{  OrderID: {    "TotalPrice":$sum(Product.(Price * Quantity)),    "Items": Product."Product Name"  }}`,
			data:  map[string]interface{}{`Account`: map[string]interface{}{`Account Name`: `Firefly`, `Order`: []interface{}{map[string]interface{}{`OrderID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 2, `SKU`: `0406654608`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Orange`, `Depth`: 210, `Height`: 200, `Weight`: 0.6, `Width`: 300}, `Price`: 21.67, `Product Name`: `Trilby hat`, `ProductID`: 858236, `Quantity`: 1, `SKU`: `0406634348`}}}, map[string]interface{}{`OrderID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 4, `SKU`: `040657863`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Black`, `Depth`: 210, `Height`: 20, `Weight`: 2, `Width`: 30}, `Price`: 107.99, `Product Name`: `Cloak`, `ProductID`: 345664, `Quantity`: 1, `SKU`: `0406654603`}}}}}},

			expected: map[string]interface{}{`order103`: map[string]interface{}{`Items`: []interface{}{`Bowler Hat`, `Trilby hat`}, `TotalPrice`: 90.57000000000001}, `order104`: map[string]interface{}{`Items`: []interface{}{`Bowler Hat`, `Cloak`}, `TotalPrice`: 245.79000000000002}},
		},

		{
			name:  "case020",
			query: `{  "Order": Account.Order.{      "ID": OrderID,      "Product": Product.{          "Name": $."Product Name",          "SKU": ProductID,          "Details": {            "Weight": Description.Weight,            "Dimensions": Description.(Width & " x " & Height & " x " & Depth)          }        },      "Total Price": $sum(Product.(Price * Quantity))    }}`,
			data:  map[string]interface{}{`Account`: map[string]interface{}{`Account Name`: `Firefly`, `Order`: []interface{}{map[string]interface{}{`OrderID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 2, `SKU`: `0406654608`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Orange`, `Depth`: 210, `Height`: 200, `Weight`: 0.6, `Width`: 300}, `Price`: 21.67, `Product Name`: `Trilby hat`, `ProductID`: 858236, `Quantity`: 1, `SKU`: `0406634348`}}}, map[string]interface{}{`OrderID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 4, `SKU`: `040657863`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Black`, `Depth`: 210, `Height`: 20, `Weight`: 2, `Width`: 30}, `Price`: 107.99, `Product Name`: `Cloak`, `ProductID`: 345664, `Quantity`: 1, `SKU`: `0406654603`}}}}}},

			expected: map[string]interface{}{`Order`: []interface{}{map[string]interface{}{`ID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Details`: map[string]interface{}{`Dimensions`: `300 x 200 x 210`, `Weight`: 0.75}, `Name`: `Bowler Hat`, `SKU`: 858383}, map[string]interface{}{`Details`: map[string]interface{}{`Dimensions`: `300 x 200 x 210`, `Weight`: 0.6}, `Name`: `Trilby hat`, `SKU`: 858236}}, `Total Price`: 90.57000000000001}, map[string]interface{}{`ID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Details`: map[string]interface{}{`Dimensions`: `300 x 200 x 210`, `Weight`: 0.75}, `Name`: `Bowler Hat`, `SKU`: 858383}, map[string]interface{}{`Details`: map[string]interface{}{`Dimensions`: `30 x 20 x 210`, `Weight`: 2}, `Name`: `Cloak`, `SKU`: 345664}}, `Total Price`: 245.79000000000002}}},
		},

		{
			name:  "case021",
			query: `{  "Order": Account.Order.{      "ID": OrderID,      "Product": Product.{          "Name": ` + "`" + `Product Name` + "`" + `,          "SKU": ProductID,          "Details": {            "Weight": Description.Weight,            "Dimensions": Description.(Width & " x " & Height & " x " & Depth)          }        },      "Total Price": $sum(Product.(Price * Quantity))    }}`,
			data:  map[string]interface{}{`Account`: map[string]interface{}{`Account Name`: `Firefly`, `Order`: []interface{}{map[string]interface{}{`OrderID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 2, `SKU`: `0406654608`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Orange`, `Depth`: 210, `Height`: 200, `Weight`: 0.6, `Width`: 300}, `Price`: 21.67, `Product Name`: `Trilby hat`, `ProductID`: 858236, `Quantity`: 1, `SKU`: `0406634348`}}}, map[string]interface{}{`OrderID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Purple`, `Depth`: 210, `Height`: 200, `Weight`: 0.75, `Width`: 300}, `Price`: 34.45, `Product Name`: `Bowler Hat`, `ProductID`: 858383, `Quantity`: 4, `SKU`: `040657863`}, map[string]interface{}{`Description`: map[string]interface{}{`Colour`: `Black`, `Depth`: 210, `Height`: 20, `Weight`: 2, `Width`: 30}, `Price`: 107.99, `Product Name`: `Cloak`, `ProductID`: 345664, `Quantity`: 1, `SKU`: `0406654603`}}}}}},

			expected: map[string]interface{}{`Order`: []interface{}{map[string]interface{}{`ID`: `order103`, `Product`: []interface{}{map[string]interface{}{`Details`: map[string]interface{}{`Dimensions`: `300 x 200 x 210`, `Weight`: 0.75}, `Name`: `Bowler Hat`, `SKU`: 858383}, map[string]interface{}{`Details`: map[string]interface{}{`Dimensions`: `300 x 200 x 210`, `Weight`: 0.6}, `Name`: `Trilby hat`, `SKU`: 858236}}, `Total Price`: 90.57000000000001}, map[string]interface{}{`ID`: `order104`, `Product`: []interface{}{map[string]interface{}{`Details`: map[string]interface{}{`Dimensions`: `300 x 200 x 210`, `Weight`: 0.75}, `Name`: `Bowler Hat`, `SKU`: 858383}, map[string]interface{}{`Details`: map[string]interface{}{`Dimensions`: `30 x 20 x 210`, `Weight`: 2}, `Name`: `Cloak`, `SKU`: 345664}}, `Total Price`: 245.79000000000002}}},
		},

		{
			name:  "case022",
			query: `Phone{type: $join(number, ", "), "phone":number}`,
			data:  map[string]interface{}{`Address`: map[string]interface{}{`City`: `Winchester`, `Postcode`: `SO21 2JN`, `Street`: `Hursley Park`}, `Age`: 28, `Email`: []interface{}{map[string]interface{}{`address`: []interface{}{`fred.smith@my-work.com`, `fsmith@my-work.com`}, `type`: `work`}, map[string]interface{}{`address`: []interface{}{`freddy@my-social.com`, `frederic.smith@very-serious.com`}, `type`: `home`}}, `FirstName`: `Fred`, `Other`: map[string]interface{}{`Alternative.Address`: map[string]interface{}{`City`: `London`, `Postcode`: `E1 6RF`, `Street`: `Brick Lane`}, `Misc`: nil, `Over 18 ?`: true}, `Phone`: []interface{}{map[string]interface{}{`number`: `0203 544 1234`, `type`: `home`}, map[string]interface{}{`number`: `01962 001234`, `type`: `office`}, map[string]interface{}{`number`: `01962 001235`, `type`: `office`}, map[string]interface{}{`number`: `077 7700 1234`, `type`: `mobile`}}, `Surname`: `Smith`},

			expected: map[string]interface{}{`home`: `0203 544 1234`, `mobile`: `077 7700 1234`, `office`: `01962 001234, 01962 001235`, `phone`: []interface{}{`0203 544 1234`, `01962 001234`, `01962 001235`, `077 7700 1234`}},
		},

		{
			name:  "case023",
			query: `$.{ type: $average(value), kind: $sum(value) } `,
			data:  []interface{}{map[string]interface{}{`kind`: `a`, `type`: `a`, `value`: 0}, map[string]interface{}{`kind`: `b`, `type`: `a`, `value`: 1}, map[string]interface{}{`kind`: `a`, `type`: `b`, `value`: 2}, map[string]interface{}{`kind`: `b`, `type`: `b`, `value`: 3}},

			shouldError: true,
			errorCode:   "D1009",
		},

		{
			name:  "case024",
			query: `{ type: $average(value), kind: $sum(value) } `,
			data:  []interface{}{map[string]interface{}{`kind`: `a`, `type`: `a`, `value`: 0}, map[string]interface{}{`kind`: `b`, `type`: `a`, `value`: 1}, map[string]interface{}{`kind`: `a`, `type`: `b`, `value`: 2}, map[string]interface{}{`kind`: `b`, `type`: `b`, `value`: 3}},

			shouldError: true,
			errorCode:   "T1003",
		},

		{
			name: "case025",
			query: `$each(jsonata, Î»($v, $k){
{
  'date': $k,
  'count': $v
}
}){
  $substring(date, 0, 7): $sum(count)
}`,
			data: map[string]interface{}{`jsonata`: map[string]interface{}{`2019-01-01`: 889, `2019-01-02`: 1792, `2019-01-03`: 2236, `2019-01-04`: 2544, `2019-01-05`: 1448, `2019-01-06`: 1544, `2019-01-07`: 2351, `2019-01-08`: 2513, `2019-01-09`: 2709, `2019-01-10`: 2573, `2019-01-11`: 2776, `2019-01-12`: 1366, `2019-01-13`: 1423, `2019-01-14`: 2372, `2019-01-15`: 2420, `2019-01-16`: 2438, `2019-01-17`: 2420, `2019-01-18`: 2658, `2019-01-19`: 1424, `2019-01-20`: 1260, `2019-01-21`: 2466, `2019-01-22`: 2708, `2019-01-23`: 2991, `2019-01-24`: 2429, `2019-01-25`: 2491, `2019-01-26`: 1459, `2019-01-27`: 1444, `2019-01-28`: 2722, `2019-01-29`: 2987, `2019-01-30`: 2670, `2019-01-31`: 2758, `2019-02-01`: 2757, `2019-02-02`: 1418, `2019-02-03`: 1626, `2019-02-04`: 2541, `2019-02-05`: 2600, `2019-02-06`: 2595, `2019-02-07`: 2627, `2019-02-08`: 2290, `2019-02-09`: 1301, `2019-02-10`: 1491, `2019-02-11`: 2731, `2019-02-12`: 2789, `2019-02-13`: 2522, `2019-02-14`: 2757, `2019-02-15`: 2462, `2019-02-16`: 1485, `2019-02-17`: 1585, `2019-02-18`: 2243, `2019-02-19`: 2865, `2019-02-20`: 2714, `2019-02-21`: 2631, `2019-02-22`: 2532, `2019-02-23`: 1408, `2019-02-24`: 1301, `2019-02-25`: 2502, `2019-02-26`: 2731, `2019-02-27`: 2616, `2019-02-28`: 2552, `2019-03-01`: 2462, `2019-03-02`: 1647, `2019-03-03`: 1319, `2019-03-04`: 2788, `2019-03-05`: 3008, `2019-03-06`: 2528, `2019-03-07`: 2662, `2019-03-08`: 2521, `2019-03-09`: 1536, `2019-03-10`: 1400, `2019-03-11`: 2617, `2019-03-12`: 3258, `2019-03-13`: 3424, `2019-03-14`: 3267, `2019-03-15`: 2940, `2019-03-16`: 1976, `2019-03-17`: 1709, `2019-03-18`: 1281, `2019-03-19`: 3484, `2019-03-20`: 3555, `2019-03-21`: 3223, `2019-03-22`: 3011, `2019-03-23`: 1847, `2019-03-24`: 1942, `2019-03-25`: 3015, `2019-03-26`: 3372, `2019-03-27`: 3518, `2019-03-28`: 3150, `2019-03-29`: 3015, `2019-03-30`: 1645, `2019-03-31`: 1505, `2019-04-01`: 3215, `2019-04-02`: 3165, `2019-04-03`: 3117, `2019-04-04`: 3009, `2019-04-05`: 3452, `2019-04-06`: 1628, `2019-04-07`: 1555, `2019-04-08`: 3156, `2019-04-09`: 2875, `2019-04-10`: 2986, `2019-04-11`: 2985, `2019-04-12`: 2789, `2019-04-13`: 1415, `2019-04-14`: 1442, `2019-04-15`: 2661, `2019-04-16`: 3073, `2019-04-17`: 2975, `2019-04-18`: 2672, `2019-04-19`: 1930, `2019-04-20`: 1203, `2019-04-21`: 1170, `2019-04-22`: 2534, `2019-04-23`: 3070, `2019-04-24`: 3800, `2019-04-25`: 3131, `2019-04-26`: 3073, `2019-04-27`: 1520, `2019-04-28`: 1390, `2019-04-29`: 2756, `2019-04-30`: 2758, `2019-05-01`: 2507, `2019-05-02`: 3208, `2019-05-03`: 3445, `2019-05-04`: 1685, `2019-05-05`: 1495, `2019-05-06`: 3269, `2019-05-07`: 3426, `2019-05-08`: 3258, `2019-05-09`: 3178, `2019-05-10`: 2997, `2019-05-11`: 1627, `2019-05-12`: 1223, `2019-05-13`: 3102, `2019-05-14`: 3587, `2019-05-15`: 3100, `2019-05-16`: 3367, `2019-05-17`: 3221, `2019-05-18`: 1530, `2019-05-19`: 1182, `2019-05-20`: 2957, `2019-05-21`: 3311, `2019-05-22`: 3661, `2019-05-23`: 3577, `2019-05-24`: 3053, `2019-05-25`: 1328, `2019-05-26`: 1204, `2019-05-27`: 2641, `2019-05-28`: 8328, `2019-05-29`: 17660, `2019-05-30`: 15634, `2019-05-31`: 15599, `2019-06-01`: 4822, `2019-06-02`: 5264, `2019-06-03`: 19349, `2019-06-04`: 21550, `2019-06-05`: 36310, `2019-06-06`: 18592, `2019-06-07`: 17869, `2019-06-08`: 4877, `2019-06-09`: 4324, `2019-06-10`: 17473, `2019-06-11`: 20640, `2019-06-12`: 20604, `2019-06-13`: 20963, `2019-06-14`: 16736, `2019-06-15`: 4112, `2019-06-16`: 4349, `2019-06-17`: 23274, `2019-06-18`: 25012, `2019-06-19`: 21058, `2019-06-20`: 20439, `2019-06-21`: 21925, `2019-06-22`: 4618, `2019-06-23`: 4925, `2019-06-24`: 24140, `2019-06-25`: 23948, `2019-06-26`: 22750, `2019-06-27`: 23307, `2019-06-28`: 21104, `2019-06-29`: 4903, `2019-06-30`: 5007, `2019-07-01`: 23655, `2019-07-02`: 27579, `2019-07-03`: 27072, `2019-07-04`: 23840, `2019-07-05`: 19827, `2019-07-06`: 5015, `2019-07-07`: 5914, `2019-07-08`: 27916, `2019-07-09`: 29980, `2019-07-10`: 30276, `2019-07-11`: 30459, `2019-07-12`: 24334, `2019-07-13`: 6853, `2019-07-14`: 7217, `2019-07-15`: 28602, `2019-07-16`: 29082, `2019-07-17`: 31428, `2019-07-18`: 29343, `2019-07-19`: 28385, `2019-07-20`: 5610, `2019-07-21`: 5980, `2019-07-22`: 29996, `2019-07-23`: 31486, `2019-07-24`: 31543, `2019-07-25`: 28539, `2019-07-26`: 26029, `2019-07-27`: 5169, `2019-07-28`: 5936, `2019-07-29`: 31774, `2019-07-30`: 27629, `2019-07-31`: 32280, `2019-08-01`: 32947, `2019-08-02`: 28920, `2019-08-03`: 6538, `2019-08-04`: 7263, `2019-08-05`: 32893, `2019-08-06`: 33360, `2019-08-07`: 31727, `2019-08-08`: 32074, `2019-08-09`: 27695, `2019-08-10`: 7007, `2019-08-11`: 7640, `2019-08-12`: 29802, `2019-08-13`: 35060, `2019-08-14`: 34097, `2019-08-15`: 27904, `2019-08-16`: 28759, `2019-08-17`: 6614, `2019-08-18`: 8024, `2019-08-19`: 33020, `2019-08-20`: 35527, `2019-08-21`: 34475, `2019-08-22`: 33838, `2019-08-23`: 29362, `2019-08-24`: 7680, `2019-08-25`: 9561, `2019-08-26`: 32594, `2019-08-27`: 38115, `2019-08-28`: 37219, `2019-08-29`: 38805, `2019-08-30`: 31773, `2019-08-31`: 8029}},

			expected: map[string]interface{}{`2019-01`: 68281, `2019-02`: 63672, `2019-03`: 78625, `2019-04`: 76505, `2019-05`: 129360, `2019-06`: 484244, `2019-07`: 698748, `2019-08`: 788322},
		},

		{
			name:  "case026",
			query: `$${id:{'label':label,'value':value}}`,
			data:  []interface{}{},

			expected: map[string]interface{}{},
		},
	}

	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			// Parse expression
			expr, err := parser.Parse(tc.query)
			if err != nil {
				if tc.shouldError {
					// Expected error during parsing
					return
				}
				t.Fatalf("Parse error: %v", err)
			}

			// Evaluate
			ev := evaluator.New()
			var result interface{}

			if tc.bindings != nil {
				result, err = ev.EvalWithBindings(context.Background(), expr, tc.data, tc.bindings)
			} else {
				result, err = ev.Eval(context.Background(), expr, tc.data)
			}

			// Check error expectation
			if tc.shouldError {
				if err == nil {
					t.Errorf("Expected error but got result: %s", formatResultForTest(result))
				}
				// TODO: Check error code when error types are implemented
				return
			}

			if err != nil {
				t.Fatalf("Eval error: %v", err)
			}

			// Compare results (basic comparison for now)
			// TODO: Implement proper deep comparison with JSONata semantics
			if !compareResults(result, tc.expected) {
				t.Errorf("Result mismatch\nGot:      %s\nExpected: %s", formatResultForTest(result), formatExpectedForTest(tc.expected))
			}
		})
	}
}
